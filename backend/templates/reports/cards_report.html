{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'uz' }}">
  <head>
    <meta charset="UTF-8" />
    <title>{% trans 'Payment statistics by card' %}</title>
    <style>
      @page { size: A4; margin: 2cm; }
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; font-size: 11pt; color: #111827; }
      h1 { text-align: center; margin: 10px 0 16px; color: #0f172a; font-size: 18pt; }
      .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
      .company-name { font-weight: bold; font-size: 14pt; color: #0f172a; }
      .meta { font-size: 10pt; color: #374151; }
      table { width: 100%; border-collapse: collapse; margin-top: 10px; }
      th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; }
      th { background: #f3f4f6; color: #111827; }
      tfoot td { font-weight: bold; border-top: 2px solid #111827; }
      .muted { color: #6b7280; }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="company-name">
        {{ company.name|default:"LENZA ERP" }}
      </div>
      {% if logo_url %}
        <img src="{{ logo_url }}" alt="logo" height="40" />
      {% endif %}
    </div>

    <h1>{% trans 'Payment statistics by card' %}</h1>
    <p class="meta">{% trans 'Period' %}: {{ from_date|default:"-" }} — {{ to_date|default:"-" }}</p>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>{% trans 'Card name' %}</th>
          <th>{% trans 'Number' %}</th>
          <th>{% trans 'User' %}</th>
          <th>{% trans 'Payment count' %}</th>
          <th>{% trans 'Total amount (USD)' %}</th>
          <th>{% trans 'Last payment' %}</th>
        </tr>
      </thead>
      <tbody>
        {% for row in data %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ row.card__name|default:"—" }}</td>
          <td>
            {% if row.card__number %}
              {{ row.card__number|slice:":4" }} **** {{ row.card__number|slice:"-4:" }}
            {% else %}
              —
            {% endif %}
          </td>
          <td>{{ row.card__holder_name|default:"—" }}</td>
          <td>{{ row.payments_count|default:0 }}</td>
          <td>${{ row.total_amount|default:0|floatformat:2 }}</td>
          <td>{% if row.last_payment %}{{ row.last_payment|date:"d.m.Y" }}{% else %}—{% endif %}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="muted">{% trans 'No data found' %}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="5">{% trans 'Total' %}</td>
          <td>${{ total_sum|floatformat:2 }}</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <p class="meta" style="margin-top: 24px;">{% trans 'Report generated' %}: {{ generated_at }}</p>

    <div style="margin-top: 24px; text-align: center; font-size: 10px; color: #777;">
      <p>{% trans 'Signed via' %} <strong>{{ company.name|default:"Lenza ERP" }}</strong> {% trans 'system' %}</p>
      <p>{% trans 'Scan QR to verify authenticity' %}:</p>
      <img src="{{ qr_code }}" alt="QR" style="height:80px;"/>
      <div><a href="{{ verify_url }}">{{ verify_url }}</a></div>
    </div>
  </body>
</html>
