{% load tz i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'uz' }}">
  <head>
    <meta charset="utf-8" />
    <style>
      @page {
        size: A4;
        margin: 28mm 20mm 28mm 20mm;
      }

      :root {
        --text: #0f172a;
        --muted: #64748b;
        --border: #e2e8f0;
        --accent: #0d9488;
        --bg: #ffffff;
      }

      body {
        font-family: 'DejaVu Sans', 'Arial Unicode MS', Arial, sans-serif;
        font-size: 12px;
        color: var(--text);
        background: var(--bg);
        line-height: 1.5;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 18px;
      }

      .logo {
        font-size: 20px;
        font-weight: 700;
        letter-spacing: 0.08em;
      }

      .tagline {
        font-size: 11px;
        color: var(--muted);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
      }

      th, td {
        padding: 10px 12px;
        border: 1px solid var(--border);
      }

      thead {
        background: #f8fafc;
      }

      th {
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.08em;
        color: var(--muted);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 10px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 600;
      }

      .badge.good {
        background: #ecfdf5;
        color: #047857;
      }

      .badge.defective {
        background: #fef2f2;
        color: #b91c1c;
      }

      .footer {
        margin-top: 32px;
        display: flex;
        justify-content: space-between;
        font-size: 11px;
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <section class="header">
      <div>
        <div class="logo">{{ company_name|default:"LENZA ERP" }}</div>
        <div class="tagline">{{ company_slogan|default:"Returns Report" }}</div>
        <div class="tagline">{{ company_address }}{% if company_phone %} | {{ company_phone }}{% endif %}</div>
      </div>
      <div style="text-align:right; font-size:12px;">
        <div><strong>{% trans 'Report' %}:</strong> {% trans 'Returns' %}</div>
        <div>{% trans 'Generated' %}: {% now "d.m.Y H:i" %}</div>
        <div>{% trans 'Total records' %}: {{ returns|length }}</div>
      </div>
    </section>

    <table>
      <thead>
        <tr>
          <th style="width: 24px;">#</th>
          <th>{% trans 'Dealer' %}</th>
          <th>{% trans 'Product' %}</th>
          <th style="width: 80px;">{% trans 'Quantity' %}</th>
          <th style="width: 110px;">{% trans 'Type' %}</th>
          <th>{% trans 'Reason' %}</th>
          <th style="width: 110px;">{% trans 'Date' %}</th>
        </tr>
      </thead>
      <tbody>
        {% for item in returns %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ item.dealer.name|default:'—' }}</td>
          <td>{{ item.product.name|default:'—' }}</td>
          <td>{{ item.quantity|floatformat:2 }}</td>
          <td>
            {% if item.return_type == 'defective' %}
              <span class="badge defective">{% trans 'Defective' %}</span>
            {% else %}
              <span class="badge good">{% trans 'Good' %}</span>
            {% endif %}
          </td>
          <td>{{ item.reason|default:'—' }}</td>
          <td>{{ item.created_at|date:"d.m.Y H:i" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" style="text-align:center; color: var(--muted); padding: 20px;">
            {% trans 'No data found' %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="footer">
      <div>{% trans 'Signed via' %} <strong>{{ company_name|default:"Lenza ERP" }}</strong> {% trans 'system' %}</div>
      <div>
        <div>{% trans 'Scan QR to verify authenticity' %}:</div>
        <img src="{{ qr_code }}" alt="QR" style="height:80px;"/>
        <div><a href="{{ verify_url }}">{{ verify_url }}</a></div>
      </div>
    </div>
  </body>
</html>
